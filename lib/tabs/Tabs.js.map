{"version":3,"names":[],"mappings":"","sources":["tabs/Tabs.js"],"sourcesContent":["/**\n * @file Tabs\n * @author huangjing\n * @date 2017-07-13\n */\n\nimport {h, Component, cloneElement} from 'preact';\nimport classNames from '../util/classnames';\nimport {setStyle, query, closest} from '../util/dom';\nimport {map} from '../util/lang';\n\nimport Tab from './Tab';\n\n\nexport default class Tabs extends Component {\n\n    constructor(props) {\n\n        super(props);\n\n        const selectedIndex = props.selectedIndex;\n\n        /**\n         * 状态\n         *\n         * @private\n         * @type {Object}\n         */\n        this.state = {\n            selectedIndex,\n            hasAnimate: false\n        };\n    }\n\n    static defaultProps = {\n        prefixCls: 'cui',\n        selectedIndex: 0,\n        // 类型，目前的值为 blockline 和 txtline， 默认为blockLine\n        type: 'blockline',\n        // 切换tab时底边是否有滑动动画\n        hasAnimate: true,\n        // 鼠标在tab上移动时 是否有跟随效果\n        hoverAnimate: false,\n        onChange() {}\n    };\n\n    static Tab = Tab;\n\n    componentDidMount() {\n\n        // 更新底边的状态\n        this.doStick(true);\n    }\n\n    componentWillReceiveProps({selectedIndex}) {\n\n        if (selectedIndex !== this.state.selectedIndex) {\n            this.setState({\n                selectedIndex\n            });\n        }\n    }\n\n    componentDidUpdate() {\n        // 更新底边的状态,\n        // 因为子组件Tab的渲染顺序在父组件之后，所以需要等待他们ready后再执行位置的更新\n        setTimeout(() => {\n            // 全屏类型的不需要滚动\n            this.doStick();\n        }, 0);\n    }\n\n    doStick(isFirst) {\n        const sel = `.${this.props.prefixCls}-tabs-tab-active`;\n        let el = query(sel, this.main);\n        this.stickBorder(el, isFirst);\n    }\n\n    stickBorder(target, isFirst) {\n        if (!target) {\n            return;\n        }\n\n        let {clientWidth, offsetLeft} = target;\n\n        if (this.props.type === 'txtline') {\n            let el = query(`.${this.props.prefixCls}-tabs-tab-txt`, target);\n            clientWidth = el.clientWidth;\n            offsetLeft += (target.clientWidth - clientWidth) / 2 || 0;\n        }\n\n        setStyle(this.line, 'display', 'block');\n        setStyle(this.line, 'width', clientWidth + 'px');\n        setStyle(this.line, 'left', `${offsetLeft}px`);\n\n        // 在第一次渲染后才加上底边滑动动效类，不然一开始滑到相应tab下会不好看\n        if (isFirst) {\n            this.setState({\n                hasAnimate: this.props.hasAnimate\n            });\n        }\n    }\n\n    onTabClick(e, index) {\n\n        if (index === this.state.selectedIndex) {\n            return;\n        }\n\n        let onChange = this.props.onChange;\n\n        this.setState({selectedIndex: index}, () => {\n            onChange && onChange({\n                type: 'change',\n                selectedIndex: index,\n                target: this\n            });\n        });\n    }\n\n    onMouseOver(e) {\n        if (!this.props.hoverAnimate) {\n            return;\n        }\n\n        let el = closest(e.target, `.${this.props.prefixCls}-tabs-tab`, this.main);\n        if (el) {\n            this.stickBorder(el);\n        }\n\n    }\n\n    onMouseLeave(e) {\n        if (!this.props.hoverAnimate) {\n            return;\n        }\n        let el = closest(e.target, `.${this.props.prefixCls}-tabs-tab`, this.main);\n        if (el) {\n            this.doStick();\n        }\n    }\n\n    render({prefixCls, className, children, type}) {\n\n        let selectedIndex = this.state.selectedIndex;\n\n        let tabs = map(children, (tab, index) => {\n\n            let selected = selectedIndex === index;\n\n            return cloneElement(\n                tab,\n                {\n                    key: index,\n                    selected: selected,\n                    index: index,\n                    onClick: (e, index) => this.onTabClick(e, index),\n                    onMouseOver: e => this.onMouseOver(e),\n                    onMouseLeave: e => this.onMouseLeave(e)\n                }\n            );\n        });\n\n        const cls = classNames({\n            [`${prefixCls}-tabs`]: true,\n            [`${prefixCls}-tabs-blockline`]: type === 'blockline',\n            [`${prefixCls}-tabs-txtline`]: type === 'txtline',\n            [className]: className\n        });\n\n        const inkBarCls = classNames({\n            [`${prefixCls}-tabs-ink-bar`]: true,\n            [`${prefixCls}-tabs-ink-bar-animated`]: this.state.hasAnimate\n        });\n\n        return (\n            <div className={cls} ref={node => this.main = node}>\n                <div className={`${prefixCls}-tabs-bar`}>\n                    <div className={`${prefixCls}-tabs-nav-container`}>\n                        <div className={`${prefixCls}-tabs-nav-wrap`}>\n                            <div className={`${prefixCls}-tabs-nav-scroll`}>\n                                <div className={`${prefixCls}-tabs-nav`} ref={node => this.nav = node}>\n                                    <div\n                                        className={inkBarCls}\n                                        ref={node => this.line = node}\n                                    />\n                                    {tabs}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        );\n    }\n\n}\n"],"file":"Tabs.js"}