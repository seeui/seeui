{"version":3,"sources":["pager/Pager.js"],"names":["Pager","props","page","state","onMainClick","bind","componentWillReceiveProps","nextProps","total","setState","range","start","stop","paddingLeft","paddingRight","rangeArray","step","arguments","length","Math","max","ceil","Array","idx","renderItem","conf","part","states","prefixCls","lang","useLang","pageText","prev","disabled","current","next","ellipsis","e","preventDefault","target","tar","getAttribute","parentNode","first","onChange","render","padding","showCount","showAlways","className","others","showCountNew","wing","floor","reduceLeftToRight","wingLeft","wingRight","reduceRightToLeft","left","right","full","min","result","map","abs","cls","defaultProps"],"mappings":"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","file":"Pager.js","sourcesContent":["/**\n * @file Pager\n * @author zhaiwanli\n */\n\nimport {h, Component} from 'preact';\nimport Icon from '../icon/Icon';\nimport classNames from '../util/classnames';\n\n\n/**\n * Pager\n *\n * @extends {preact.Component}\n * @class\n */\nexport default class Pager extends Component {\n\n    static defaultProps = {\n        prefixCls: 'cui',\n        // 当前页，第一页从0开始\n        page: 1,\n\n        // 起始页码\n        first: 1,\n\n        // 首尾显示的页码个数\n        padding: 1,\n\n        // 是否一直显示分页控件\n        showAlways: false,\n\n        // 当页数较多时，中间显示页码的个数\n        showCount: 5,\n\n        // 总页数\n        total: 0,\n\n        // 是否可用\n        disabled: false,\n\n        // 是否使用文字\n        useLang: false,\n\n        // 上下页显示文字\n        lang: {\n\n            // 上一页显示文字\n            prev: '上一页',\n\n            // 下一页显示文字\n            next: '下一页',\n\n            // 省略号\n            ellipsis: '..'\n        }\n    };\n\n    /**\n     * 构造函数\n     *\n     * @public\n     * @constructor\n     * @param {*} props 属性\n     */\n    constructor(props) {\n\n        super(props);\n\n        const page = props.page;\n\n        /**\n         * 状态\n         *\n         * @protected\n         * @type {Object}\n         */\n        this.state = {page};\n\n        this.onMainClick = this.onMainClick.bind(this);\n\n    }\n\n    /**\n     * 接受新属性时的处理\n     *\n     * @public\n     * @override\n     * @param {*} nextProps 新属性\n     */\n    componentWillReceiveProps(nextProps) {\n\n        let {page, total} = nextProps;\n\n        if (page < 0) {\n            page = 0;\n        }\n        else if (page > total) {\n            page = total - 1;\n        }\n\n        if (page !== this.state.page) {\n            this.setState({page});\n        }\n    }\n\n    /**\n     * 生成一个页码数组, 如果需要ellipsis, 那么ellpsis用负数表示它;\n     * 即ellipsis在5号位置, 那么他就是-5\n     * 输入: start 0, stop 10, paddingLeft 3 paddingRight 3\n     * 输出: 0, 1, 2, -3, 8, 9, 10\n     *\n     * @private\n     * @param  {number} start        起始页码\n     * @param  {number} stop         结束页面(不包含)\n     * @param  {number} paddingLeft  起始页码之后, 应展开的页码个数\n     * @param  {number} paddingRight 结束页面之前, 应展开的页码个数\n     * @return {Array<number>}        [start, paddingLeft, .., paddingRight, stop]\n     */\n    range(start, stop, paddingLeft, paddingRight) {\n        return start + paddingLeft < stop - paddingRight\n            ? [\n                ...this.rangeArray(start, start + paddingLeft),\n                -start - paddingLeft,\n                ...this.rangeArray(stop - paddingRight, stop)\n            ]\n            : this.rangeArray(start, stop);\n    }\n\n    rangeArray(start, stop, step = 1) {\n        /* eslint-disable prefer-rest-params */\n        if (arguments.length <= 1) {\n            stop = start || 0;\n            start = 0;\n        }\n\n        step = step || 1;\n\n        const length = Math.max(Math.ceil((stop - start) / step), 0);\n        const range = Array(length);\n\n        for (let idx = 0; idx < length; idx++, start += step) {\n            range[idx] = start;\n        }\n\n        return range;\n    }\n\n    /**\n     * 渲染页码\n     *\n     * @protected\n     * @param {Object} conf 页码的属性\n     * @return {ReactElement}\n     */\n    renderItem(conf) {\n\n        const {page, part, states} = conf;\n        const {prefixCls, lang, useLang} = this.props;\n\n        let pageText;\n\n        if (!useLang && part && part !== 'ellipsis') {\n            pageText = (part === 'prev' ? <Icon type=\"back\" /> : <Icon type=\"right\" />);\n        }\n        else {\n            pageText = lang[part] || page + 1;\n        }\n\n        return (\n            <li\n                className={classNames({\n                    [`${prefixCls}-pager-item`]: true,\n                    'state-prev': states.prev,\n                    'state-disabled': states.disabled,\n                    'state-current': states.current,\n                    'state-next': states.next,\n                    'state-ellipsis': states.ellipsis\n                })}\n                key={part + page}\n                data-role=\"pager-item\"\n                data-page={page}>\n                {pageText}\n            </li>\n        );\n    }\n\n    /**\n     * 鼠标点击时的处理\n     *\n     * @protected\n     * @param  {Object} e 事件对象\n     */\n    onMainClick(e) {\n\n        e.preventDefault();\n\n        const target = e.target;\n\n        const tar = target.getAttribute('data-role')\n            ? target\n            : target.parentNode.getAttribute('data-role')\n                ? target.parentNode\n                : '';\n\n        if (!tar) {\n            return;\n        }\n\n        const {first, onChange} = this.props;\n\n        const page = +tar.getAttribute('data-page') + first;\n\n        if (this.state.page === page) {\n            return;\n        }\n\n        this.setState({page});\n\n        // 被控制的\n        if (onChange) {\n            onChange({\n                target: this,\n                page: page\n            });\n            return;\n        }\n    }\n\n    /**\n     * 渲染\n     *\n     * @public\n     * @return {ReactElement}\n     */\n\n    render() {\n        const {prefixCls, total, first, padding, showCount, useLang, showAlways, className, ...others} = this.props;\n        let page = this.state.page;\n        let showCountNew = showCount > total ? total : showCount;\n\n        page = page - first;\n\n        if (!showAlways && total <= 1) {\n            return (\n                <ul className=\"c-pager\" />\n            );\n        }\n\n        const wing = Math.floor(showCountNew / 2);\n\n        const paddingLeft = padding;\n        const paddingRight = padding;\n        const reduceLeftToRight = page - wing;\n\n        let wingLeft = wing;\n        let wingRight = wing;\n\n        // 如果wingLeft小于0, 那么把小于0的部分移动到wingRight\n        if (reduceLeftToRight < 0) {\n            wingLeft += reduceLeftToRight;\n            wingRight -= reduceLeftToRight;\n        }\n\n        const reduceRightToLeft = page + wing + 1 - total;\n\n        // 如果wingRight大于total, 那么把超长的部分移动到wingLeft\n        if (reduceRightToLeft > 0) {\n            wingLeft += reduceRightToLeft;\n            wingRight -= reduceRightToLeft;\n        }\n\n        // 生成左半端页码\n        const left = this.range(0, page, paddingLeft, wingLeft);\n        // 生成右半端页码\n        const right = this.range(page + 1, total, wingRight, paddingRight);\n        // 全部页码\n        const full = [\n            {\n                page: Math.max(page - 1, 0),\n                states: {\n                    prev: true,\n                    disabled: page === 0\n                },\n                part: 'prev'\n            },\n            ...left,\n            {\n                page: page,\n                states: {\n                    current: true\n                },\n                part: ''\n            },\n            ...right,\n            {\n                page: Math.min(page + 1, total - 1),\n                states: {\n                    next: true,\n                    disabled: page >= total - 1\n                },\n                part: 'next'\n            }\n        ];\n\n        const result = full.map(conf => {\n\n            if (typeof conf === 'number') {\n                const part = conf >= 0 ? '' : 'ellipsis';\n                conf = {\n                    page: Math.abs(conf),\n                    states: {\n                        ellipsis: !!part\n                    },\n                    part\n                };\n            }\n\n            return this.renderItem(conf);\n\n        });\n\n        let cls = classNames({\n            [`${prefixCls}-pager`]: true,\n            [className]: className\n        });\n\n        return (\n            <ul className={cls} onClick={this.onMainClick} {...others}>\n                {result}\n            </ul>\n        );\n    }\n}\n"]}